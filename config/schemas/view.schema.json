{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/flanksource/incident-commander/api/v1/view",
  "$ref": "#/$defs/View",
  "$defs": {
    "ColumnDef": {
      "properties": {
        "name": {
          "type": "string"
        },
        "primaryKey": {
          "type": "boolean"
        },
        "type": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "hidden": {
          "type": "boolean"
        },
        "gauge": {
          "$ref": "#/$defs/GaugeConfig"
        },
        "configItem": {
          "$ref": "#/$defs/ConfigItemColumnType"
        },
        "icon": {
          "type": "string"
        },
        "for": {
          "type": "string"
        },
        "filter": {
          "$ref": "#/$defs/ColumnFilter"
        },
        "url": {
          "$ref": "#/$defs/ColumnURL"
        },
        "unit": {
          "type": "string"
        },
        "cardPosition": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name",
        "type"
      ]
    },
    "ColumnFilter": {
      "properties": {
        "type": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "type"
      ]
    },
    "ColumnURL": {
      "properties": {
        "config": {
          "type": "string"
        },
        "view": {
          "$ref": "#/$defs/ViewURLRef"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ConfigItemColumnType": {
      "properties": {
        "idField": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ConfigMapKeySelector": {
      "properties": {
        "name": {
          "type": "string"
        },
        "key": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "key"
      ]
    },
    "EnvVar": {
      "properties": {
        "name": {
          "type": "string"
        },
        "value": {
          "type": "string"
        },
        "valueFrom": {
          "$ref": "#/$defs/EnvVarSource"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "EnvVarSource": {
      "properties": {
        "serviceAccount": {
          "type": "string"
        },
        "helmRef": {
          "$ref": "#/$defs/HelmRefKeySelector"
        },
        "configMapKeyRef": {
          "$ref": "#/$defs/ConfigMapKeySelector"
        },
        "secretKeyRef": {
          "$ref": "#/$defs/SecretKeySelector"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "FieldsV1": {
      "properties": {},
      "additionalProperties": false,
      "type": "object"
    },
    "GaugeConfig": {
      "properties": {
        "max": {
          "type": "string"
        },
        "min": {
          "type": "string"
        },
        "precision": {
          "type": "integer"
        },
        "thresholds": {
          "items": {
            "$ref": "#/$defs/GaugeThreshold"
          },
          "type": "array"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "GaugeThreshold": {
      "properties": {
        "value": {
          "type": "integer"
        },
        "percent": {
          "type": "integer"
        },
        "color": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "percent",
        "color"
      ]
    },
    "HelmRefKeySelector": {
      "properties": {
        "name": {
          "type": "string"
        },
        "key": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "key"
      ]
    },
    "Items": {
      "items": {
        "type": "string"
      },
      "type": "array"
    },
    "ManagedFieldsEntry": {
      "properties": {
        "manager": {
          "type": "string"
        },
        "operation": {
          "type": "string"
        },
        "apiVersion": {
          "type": "string"
        },
        "time": {
          "$ref": "#/$defs/Time"
        },
        "fieldsType": {
          "type": "string"
        },
        "fieldsV1": {
          "$ref": "#/$defs/FieldsV1"
        },
        "subresource": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "OAuth": {
      "properties": {
        "clientID": {
          "$ref": "#/$defs/EnvVar"
        },
        "clientSecret": {
          "$ref": "#/$defs/EnvVar"
        },
        "scope": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "tokenURL": {
          "type": "string"
        },
        "params": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ObjectMeta": {
      "properties": {
        "name": {
          "type": "string"
        },
        "generateName": {
          "type": "string"
        },
        "namespace": {
          "type": "string"
        },
        "selfLink": {
          "type": "string"
        },
        "uid": {
          "type": "string"
        },
        "resourceVersion": {
          "type": "string"
        },
        "generation": {
          "type": "integer"
        },
        "creationTimestamp": {
          "$ref": "#/$defs/Time"
        },
        "deletionTimestamp": {
          "$ref": "#/$defs/Time"
        },
        "deletionGracePeriodSeconds": {
          "type": "integer"
        },
        "labels": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "annotations": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "ownerReferences": {
          "items": {
            "$ref": "#/$defs/OwnerReference"
          },
          "type": "array"
        },
        "finalizers": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "managedFields": {
          "items": {
            "$ref": "#/$defs/ManagedFieldsEntry"
          },
          "type": "array"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "OwnerReference": {
      "properties": {
        "apiVersion": {
          "type": "string"
        },
        "kind": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "uid": {
          "type": "string"
        },
        "controller": {
          "type": "boolean"
        },
        "blockOwnerDeletion": {
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "apiVersion",
        "kind",
        "name",
        "uid"
      ]
    },
    "PanelBargaugeConfig": {
      "properties": {
        "max": {
          "type": "string"
        },
        "min": {
          "type": "string"
        },
        "precision": {
          "type": "integer"
        },
        "thresholds": {
          "items": {
            "$ref": "#/$defs/GaugeThreshold"
          },
          "type": "array"
        },
        "unit": {
          "type": "string"
        },
        "group": {
          "type": "string"
        },
        "format": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "PanelDef": {
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string"
        },
        "gauge": {
          "$ref": "#/$defs/PanelGaugeConfig"
        },
        "piechart": {
          "$ref": "#/$defs/PiechartConfig"
        },
        "number": {
          "$ref": "#/$defs/PanelNumberConfig"
        },
        "table": {
          "$ref": "#/$defs/PanelTableConfig"
        },
        "bargauge": {
          "$ref": "#/$defs/PanelBargaugeConfig"
        },
        "query": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name",
        "type",
        "query"
      ]
    },
    "PanelGaugeConfig": {
      "properties": {
        "max": {
          "type": "string"
        },
        "min": {
          "type": "string"
        },
        "precision": {
          "type": "integer"
        },
        "thresholds": {
          "items": {
            "$ref": "#/$defs/GaugeThreshold"
          },
          "type": "array"
        },
        "unit": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "PanelNumberConfig": {
      "properties": {
        "unit": {
          "type": "string"
        },
        "precision": {
          "type": "integer"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "PanelTableConfig": {
      "properties": {},
      "additionalProperties": false,
      "type": "object"
    },
    "PiechartConfig": {
      "properties": {
        "showLabels": {
          "type": "boolean"
        },
        "colors": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "PrometheusQuery": {
      "properties": {
        "connection": {
          "type": "string"
        },
        "username": {
          "$ref": "#/$defs/EnvVar"
        },
        "password": {
          "$ref": "#/$defs/EnvVar"
        },
        "ntlm": {
          "type": "boolean"
        },
        "ntlmv2": {
          "type": "boolean"
        },
        "digest": {
          "type": "boolean"
        },
        "url": {
          "type": "string"
        },
        "bearer": {
          "$ref": "#/$defs/EnvVar"
        },
        "oauth": {
          "$ref": "#/$defs/OAuth"
        },
        "tls": {
          "$ref": "#/$defs/TLSConfig"
        },
        "query": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "query"
      ]
    },
    "ResourceSelector": {
      "properties": {
        "agent": {
          "type": "string"
        },
        "scope": {
          "type": "string"
        },
        "cache": {
          "type": "string"
        },
        "search": {
          "type": "string"
        },
        "limit": {
          "type": "integer"
        },
        "includeDeleted": {
          "type": "boolean"
        },
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "namespace": {
          "type": "string"
        },
        "tagSelector": {
          "type": "string"
        },
        "labelSelector": {
          "type": "string"
        },
        "fieldSelector": {
          "type": "string"
        },
        "health": {
          "type": "string"
        },
        "types": {
          "$ref": "#/$defs/Items"
        },
        "statuses": {
          "$ref": "#/$defs/Items"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "SecretKeySelector": {
      "properties": {
        "name": {
          "type": "string"
        },
        "key": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "key"
      ]
    },
    "TLSConfig": {
      "properties": {
        "insecureSkipVerify": {
          "type": "boolean"
        },
        "handshakeTimeout": {
          "type": "integer"
        },
        "ca": {
          "$ref": "#/$defs/EnvVar"
        },
        "cert": {
          "$ref": "#/$defs/EnvVar"
        },
        "key": {
          "$ref": "#/$defs/EnvVar"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "Time": {
      "properties": {},
      "additionalProperties": false,
      "type": "object"
    },
    "View": {
      "properties": {
        "kind": {
          "type": "string"
        },
        "apiVersion": {
          "type": "string"
        },
        "metadata": {
          "$ref": "#/$defs/ObjectMeta"
        },
        "spec": {
          "$ref": "#/$defs/ViewSpec"
        },
        "status": {
          "$ref": "#/$defs/ViewStatus"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "metadata",
        "spec",
        "status"
      ]
    },
    "ViewCache": {
      "properties": {
        "maxAge": {
          "type": "string"
        },
        "minAge": {
          "type": "string"
        },
        "refreshTimeout": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ViewColumnDefList": {
      "items": {
        "$ref": "#/$defs/ColumnDef"
      },
      "type": "array"
    },
    "ViewConfigUIPlugin": {
      "properties": {
        "configTab": {
          "$ref": "#/$defs/ResourceSelector"
        },
        "filter": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "configTab"
      ]
    },
    "ViewDisplay": {
      "properties": {
        "ordinal": {
          "type": "integer"
        },
        "sidebar": {
          "type": "boolean"
        },
        "icon": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "plugins": {
          "items": {
            "$ref": "#/$defs/ViewConfigUIPlugin"
          },
          "type": "array"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ViewQueryWithColumnDefs": {
      "properties": {
        "prometheus": {
          "$ref": "#/$defs/PrometheusQuery"
        },
        "configs": {
          "$ref": "#/$defs/ResourceSelector"
        },
        "changes": {
          "$ref": "#/$defs/ResourceSelector"
        },
        "viewTableSelector": {
          "$ref": "#/$defs/ViewSelector"
        },
        "columns": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ViewSelector": {
      "properties": {
        "name": {
          "type": "string"
        },
        "namespace": {
          "type": "string"
        },
        "labelSelector": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ViewSpec": {
      "properties": {
        "description": {
          "type": "string"
        },
        "display": {
          "$ref": "#/$defs/ViewDisplay"
        },
        "panels": {
          "items": {
            "$ref": "#/$defs/PanelDef"
          },
          "type": "array"
        },
        "columns": {
          "$ref": "#/$defs/ViewColumnDefList"
        },
        "queries": {
          "additionalProperties": {
            "$ref": "#/$defs/ViewQueryWithColumnDefs"
          },
          "type": "object"
        },
        "merge": {
          "type": "string"
        },
        "mapping": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "cache": {
          "$ref": "#/$defs/ViewCache"
        },
        "templating": {
          "items": {
            "$ref": "#/$defs/ViewVariable"
          },
          "type": "array"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "columns",
        "queries",
        "cache"
      ]
    },
    "ViewStatus": {
      "properties": {
        "lastRan": {
          "$ref": "#/$defs/Time"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ViewURLRef": {
      "properties": {
        "namespace": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "filter": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ViewVariable": {
      "properties": {
        "key": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "values": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "valueFrom": {
          "$ref": "#/$defs/ViewVariableValueFrom"
        },
        "default": {
          "type": "string"
        },
        "dependsOn": {
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "key",
        "label"
      ]
    },
    "ViewVariableValueFrom": {
      "properties": {
        "config": {
          "$ref": "#/$defs/ResourceSelector"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "config"
      ]
    }
  }
}