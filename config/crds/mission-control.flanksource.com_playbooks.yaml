---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: playbooks.mission-control.flanksource.com
spec:
  group: mission-control.flanksource.com
  names:
    kind: Playbook
    listKind: PlaybookList
    plural: playbooks
    singular: playbook
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: Playbook is the schema for the Playbooks API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              actions:
                description: List of actions that need to be executed by this playbook.
                items:
                  properties:
                    ai:
                      properties:
                        analysis:
                          description: Select analysis for the config to provide as
                            an additional context to the AI model.
                          properties:
                            since:
                              type: string
                          required:
                          - since
                          type: object
                        apiKey:
                          description: API Key
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                helmRef:
                                  properties:
                                    key:
                                      description: Key is a JSONPath expression used
                                        to fetch the key from the merged JSON.
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                serviceAccount:
                                  description: ServiceAccount specifies the service
                                    account whose token should be fetched
                                  type: string
                              type: object
                          type: object
                        apiURL:
                          description: |-
                            BaseURL or API url.
                            Example: server URL for ollama or custom url for Anthropic if using a proxy
                          type: string
                        backend:
                          description: |-
                            Optionally specify the LLM backend.
                            Supported: anthropic (default), ollama, openai.
                          type: string
                        changes:
                          description: Select changes for the config to provide as
                            an additional context to the AI model.
                          properties:
                            since:
                              type: string
                          required:
                          - since
                          type: object
                        config:
                          description: |-
                            The config id to operate on.
                            If not provided, the playbook's config is used.
                          type: string
                        connection:
                          description: Connection to setup the llm backend connection
                          type: string
                        dryRun:
                          description: When enabled, the prompt is simply saved without
                            passing it on to the LLM.
                          type: boolean
                        formats:
                          description: |-
                            Output format of the prompt.
                            Supported: markdown (default), slack.
                          items:
                            type: string
                          type: array
                        model:
                          description: |-
                            Model name based on the backend chosen.
                            Example: gpt-4o for openai, claude-3-5-sonnet-latest for Anthropic, llama3.1:8b for Ollama
                          type: string
                        prompt:
                          description: Prompt is the humna prompt
                          type: string
                        relationships:
                          description: Select related configs to provide as an additional
                            context to the AI model.
                          items:
                            properties:
                              analysis:
                                properties:
                                  since:
                                    type: string
                                required:
                                - since
                                type: object
                              changes:
                                properties:
                                  since:
                                    type: string
                                required:
                                - since
                                type: object
                              depth:
                                description: max depth to traverse the relationship.
                                  Defaults to 3
                                type: integer
                              direction:
                                description: use incoming/outgoing/all relationships.
                                type: string
                            type: object
                          type: array
                        systemPrompt:
                          description: |-
                            system prompt is a way to provide context, instructions, and guidelines to the LLM before presenting it
                            with a question or task.
                            By using a system prompt, you can set the stage for the conversation, specifying LLM's role, personality,
                            tone, or any other relevant information that will help it better understand and respond to the user's input.
                          type: string
                      required:
                      - prompt
                      - systemPrompt
                      type: object
                    azureDevopsPipeline:
                      properties:
                        org:
                          description: Org is the name of the Azure DevOps organization
                          type: string
                        parameters:
                          description: Parameteres are the settings that influence
                            the pipeline run
                          properties:
                            resources:
                              description: The resources the run requires.
                              type: object
                            stagesToSkip:
                              items:
                                type: string
                              type: array
                            templateParameters:
                              type: object
                            variables:
                              type: object
                          type: object
                        pipeline:
                          description: Pipeline is the azure pipeline to invoke
                          properties:
                            id:
                              description: ID is the pipeline ID
                              type: string
                            version:
                              description: Version is the pipeline version
                              type: string
                          required:
                          - id
                          type: object
                        project:
                          description: Project ID or project name
                          type: string
                        token:
                          description: Token is the personal access token
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                helmRef:
                                  properties:
                                    key:
                                      description: Key is a JSONPath expression used
                                        to fetch the key from the merged JSON.
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                serviceAccount:
                                  description: ServiceAccount specifies the service
                                    account whose token should be fetched
                                  type: string
                              type: object
                          type: object
                      required:
                      - org
                      - pipeline
                      - project
                      - token
                      type: object
                    delay:
                      description: |-
                        Delay is a CEL expression that returns the duration to delay the execution of this action.
                        Valid time units are "s", "m", "h", "d", "w", "y".
                        It's only sensitive to the minute. i.e. if you delay by 20s it can take upto a minute to execute.
                      type: string
                    exec:
                      properties:
                        artifacts:
                          description: Artifacts to save
                          items:
                            properties:
                              path:
                                type: string
                            required:
                            - path
                            type: object
                          type: array
                        checkout:
                          description: Checkout details the git repository that should
                            be mounted to the process
                          properties:
                            certificate:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                                valueFrom:
                                  properties:
                                    configMapKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    helmRef:
                                      properties:
                                        key:
                                          description: Key is a JSONPath expression
                                            used to fetch the key from the merged
                                            JSON.
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    secretKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    serviceAccount:
                                      description: ServiceAccount specifies the service
                                        account whose token should be fetched
                                      type: string
                                  type: object
                              type: object
                            connection:
                              type: string
                            destination:
                              description: |-
                                Destination is the full path to where the contents of the URL should be downloaded to.
                                If left empty, the sha256 hash of the URL will be used as the dir name.
                              type: string
                            password:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                                valueFrom:
                                  properties:
                                    configMapKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    helmRef:
                                      properties:
                                        key:
                                          description: Key is a JSONPath expression
                                            used to fetch the key from the merged
                                            JSON.
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    secretKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    serviceAccount:
                                      description: ServiceAccount specifies the service
                                        account whose token should be fetched
                                      type: string
                                  type: object
                              type: object
                            url:
                              type: string
                            username:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                                valueFrom:
                                  properties:
                                    configMapKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    helmRef:
                                      properties:
                                        key:
                                          description: Key is a JSONPath expression
                                            used to fetch the key from the merged
                                            JSON.
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    secretKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    serviceAccount:
                                      description: ServiceAccount specifies the service
                                        account whose token should be fetched
                                      type: string
                                  type: object
                              type: object
                          type: object
                        connections:
                          properties:
                            aws:
                              properties:
                                accessKey:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        helmRef:
                                          properties:
                                            key:
                                              description: Key is a JSONPath expression
                                                used to fetch the key from the merged
                                                JSON.
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        serviceAccount:
                                          description: ServiceAccount specifies the
                                            service account whose token should be
                                            fetched
                                          type: string
                                      type: object
                                  type: object
                                assumeRole:
                                  type: string
                                connection:
                                  description: ConnectionName of the connection. It'll
                                    be used to populate the endpoint, accessKey and
                                    secretKey.
                                  type: string
                                endpoint:
                                  type: string
                                region:
                                  type: string
                                secretKey:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        helmRef:
                                          properties:
                                            key:
                                              description: Key is a JSONPath expression
                                                used to fetch the key from the merged
                                                JSON.
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        serviceAccount:
                                          description: ServiceAccount specifies the
                                            service account whose token should be
                                            fetched
                                          type: string
                                      type: object
                                  type: object
                                sessionToken:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        helmRef:
                                          properties:
                                            key:
                                              description: Key is a JSONPath expression
                                                used to fetch the key from the merged
                                                JSON.
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        serviceAccount:
                                          description: ServiceAccount specifies the
                                            service account whose token should be
                                            fetched
                                          type: string
                                      type: object
                                  type: object
                                skipTLSVerify:
                                  description: Skip TLS verify when connecting to
                                    aws
                                  type: boolean
                              type: object
                            azure:
                              properties:
                                clientID:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        helmRef:
                                          properties:
                                            key:
                                              description: Key is a JSONPath expression
                                                used to fetch the key from the merged
                                                JSON.
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        serviceAccount:
                                          description: ServiceAccount specifies the
                                            service account whose token should be
                                            fetched
                                          type: string
                                      type: object
                                  type: object
                                clientSecret:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        helmRef:
                                          properties:
                                            key:
                                              description: Key is a JSONPath expression
                                                used to fetch the key from the merged
                                                JSON.
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        serviceAccount:
                                          description: ServiceAccount specifies the
                                            service account whose token should be
                                            fetched
                                          type: string
                                      type: object
                                  type: object
                                connection:
                                  type: string
                                tenantID:
                                  type: string
                              type: object
                            fromConfigItem:
                              type: string
                            gcp:
                              properties:
                                connection:
                                  description: ConnectionName of the connection. It'll
                                    be used to populate the endpoint and credentials.
                                  type: string
                                credentials:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        helmRef:
                                          properties:
                                            key:
                                              description: Key is a JSONPath expression
                                                used to fetch the key from the merged
                                                JSON.
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        serviceAccount:
                                          description: ServiceAccount specifies the
                                            service account whose token should be
                                            fetched
                                          type: string
                                      type: object
                                  type: object
                                endpoint:
                                  type: string
                                skipTLSVerify:
                                  description: Skip TLS verify
                                  type: boolean
                              type: object
                            kubernetes:
                              properties:
                                connection:
                                  type: string
                                kubeconfig:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        helmRef:
                                          properties:
                                            key:
                                              description: Key is a JSONPath expression
                                                used to fetch the key from the merged
                                                JSON.
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        serviceAccount:
                                          description: ServiceAccount specifies the
                                            service account whose token should be
                                            fetched
                                          type: string
                                      type: object
                                  type: object
                              type: object
                          type: object
                        env:
                          description: EnvVars are the environment variables that
                            are accessible to exec processes
                          items:
                            properties:
                              name:
                                type: string
                              value:
                                type: string
                              valueFrom:
                                properties:
                                  configMapKeyRef:
                                    properties:
                                      key:
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                  helmRef:
                                    properties:
                                      key:
                                        description: Key is a JSONPath expression
                                          used to fetch the key from the merged JSON.
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                  secretKeyRef:
                                    properties:
                                      key:
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                  serviceAccount:
                                    description: ServiceAccount specifies the service
                                      account whose token should be fetched
                                    type: string
                                type: object
                            type: object
                          type: array
                        script:
                          description: |-
                            Script can be an inline script or a path to a script that needs to be executed
                            On windows executed via powershell and in darwin and linux executed using bash
                          type: string
                      required:
                      - script
                      type: object
                    github:
                      properties:
                        repo:
                          description: Repo is the name of the repository without
                            the .git extension
                          type: string
                        token:
                          description: Token is the personal access token
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                helmRef:
                                  properties:
                                    key:
                                      description: Key is a JSONPath expression used
                                        to fetch the key from the merged JSON.
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                serviceAccount:
                                  description: ServiceAccount specifies the service
                                    account whose token should be fetched
                                  type: string
                              type: object
                          type: object
                        username:
                          description: Username is the account owner of the repository.
                            The name is not case sensitive
                          type: string
                        workflows:
                          description: Workflows is the list of github workflows to
                            invoke
                          items:
                            properties:
                              id:
                                description: 'Id is the workflow id or the workflow
                                  file name (eg: main.yaml)'
                                type: string
                              input:
                                description: Input is the optional input keys and
                                  values, in JSON format, configured in the workflow
                                  file.
                                type: string
                              ref:
                                description: "Ref is the git reference for the workflow.\nThe
                                  reference can be a branch or tag name.\n\tDefaults
                                  to \"main\"."
                                type: string
                            required:
                            - id
                            type: object
                          type: array
                      required:
                      - repo
                      - token
                      - username
                      type: object
                    gitops:
                      properties:
                        commit:
                          properties:
                            author:
                              type: string
                            email:
                              type: string
                            message:
                              type: string
                          required:
                          - author
                          - email
                          - message
                          type: object
                        files:
                          description: |-
                            Files to create/delete.
                            Use the special "$delete" directive to delete an existing file.
                          items:
                            properties:
                              content:
                                type: string
                              path:
                                type: string
                            required:
                            - content
                            - path
                            type: object
                          type: array
                        patches:
                          items:
                            properties:
                              jq:
                                type: string
                              path:
                                type: string
                              yq:
                                type: string
                            required:
                            - path
                            type: object
                          type: array
                        pr:
                          description: |-
                            PullRequest specifies the details for the PR to be created.
                            Only if connection type is github or azuredevops then a new PR is created.
                          properties:
                            tags:
                              description: Tags to add to the PR
                              items:
                                type: string
                              type: array
                            title:
                              description: Title of the Pull request
                              type: string
                          required:
                          - title
                          type: object
                        repo:
                          properties:
                            base:
                              description: Branch to clone. Defaults to "main".
                              type: string
                            branch:
                              description: Branch is the new branch to create. Defaults
                                to Base.
                              type: string
                            connection:
                              type: string
                            force:
                              description: Overwrite history when pushing
                              type: boolean
                            password:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                                valueFrom:
                                  properties:
                                    configMapKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    helmRef:
                                      properties:
                                        key:
                                          description: Key is a JSONPath expression
                                            used to fetch the key from the merged
                                            JSON.
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    secretKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    serviceAccount:
                                      description: ServiceAccount specifies the service
                                        account whose token should be fetched
                                      type: string
                                  type: object
                              type: object
                            skipExisting:
                              description: Do not push to existing branches
                              type: boolean
                            type:
                              description: |-
                                Type specifies the service the repository is hosted on (eg: github, gitlab, etc)
                                It is deduced from the repo URL however for private repository you can
                                explicitly specify the type manually.
                              type: string
                            url:
                              description: URL of the git repository
                              type: string
                            username:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                                valueFrom:
                                  properties:
                                    configMapKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    helmRef:
                                      properties:
                                        key:
                                          description: Key is a JSONPath expression
                                            used to fetch the key from the merged
                                            JSON.
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    secretKeyRef:
                                      properties:
                                        key:
                                          type: string
                                        name:
                                          type: string
                                      required:
                                      - key
                                      type: object
                                    serviceAccount:
                                      description: ServiceAccount specifies the service
                                        account whose token should be fetched
                                      type: string
                                  type: object
                              type: object
                          required:
                          - url
                          type: object
                      required:
                      - commit
                      - repo
                      type: object
                    http:
                      properties:
                        body:
                          description: Request Body Contents
                          type: string
                        connection:
                          description: Connection name e.g. connection://http/google
                          type: string
                        headers:
                          description: Header fields to be used in the query
                          items:
                            properties:
                              name:
                                type: string
                              value:
                                type: string
                              valueFrom:
                                properties:
                                  configMapKeyRef:
                                    properties:
                                      key:
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                  helmRef:
                                    properties:
                                      key:
                                        description: Key is a JSONPath expression
                                          used to fetch the key from the merged JSON.
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                  secretKeyRef:
                                    properties:
                                      key:
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                  serviceAccount:
                                    description: ServiceAccount specifies the service
                                      account whose token should be fetched
                                    type: string
                                type: object
                            type: object
                          type: array
                        method:
                          description: Method to use - defaults to GET
                          type: string
                        ntlm:
                          description: NTLM when set to true will do authentication
                            using NTLM v1 protocol
                          type: boolean
                        ntlmv2:
                          description: NTLM when set to true will do authentication
                            using NTLM v2 protocol
                          type: boolean
                        password:
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                helmRef:
                                  properties:
                                    key:
                                      description: Key is a JSONPath expression used
                                        to fetch the key from the merged JSON.
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                serviceAccount:
                                  description: ServiceAccount specifies the service
                                    account whose token should be fetched
                                  type: string
                              type: object
                          type: object
                        templateBody:
                          description: TemplateBody controls whether the body of the
                            request needs to be templated
                          type: boolean
                        url:
                          description: Connection url, interpolated with username,password
                          type: string
                        username:
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                helmRef:
                                  properties:
                                    key:
                                      description: Key is a JSONPath expression used
                                        to fetch the key from the merged JSON.
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                serviceAccount:
                                  description: ServiceAccount specifies the service
                                    account whose token should be fetched
                                  type: string
                              type: object
                          type: object
                      type: object
                    if:
                      description: "Filter is a cel-expression that decides if this
                        action should run or not.\nThe expressions should either return
                        a boolean value ('true' indicating run the action & vice versa)\nor
                        any of these special functions.\nExamples:\n\t- filter: config.deleted_at
                        ? true: false\n\t- filter: always()\nalways(): run no matter
                        what; even if the playbook is cancelled/fails\nfailure():
                        run if any of the previous actions failed\nsuccess(): run
                        only if all previous actions succeeded (default)\ntimeout():
                        run only if any of the previous actions timed out\nskip():
                        skip running this action"
                      type: string
                    name:
                      description: Name of the action
                      type: string
                    notification:
                      properties:
                        connection:
                          description: Connection to use to send the notification
                          type: string
                        message:
                          description: Message is the body of the notification
                          type: string
                        properties:
                          additionalProperties:
                            type: string
                          description: Properties for shoutrrr
                          type: object
                        title:
                          description: Title of the notification
                          type: string
                        url:
                          description: URL for the shoutrrr connection string
                          type: string
                      required:
                      - message
                      - title
                      type: object
                    pod:
                      properties:
                        artifacts:
                          description: Artifacts to save
                          items:
                            properties:
                              path:
                                type: string
                            required:
                            - path
                            type: object
                          type: array
                        maxLength:
                          description: |-
                            MaxLength is the maximum length of the logs to show
                             Default: 3000 characters
                          type: integer
                        name:
                          description: Name is name of the pod that'll be created
                          type: string
                        spec:
                          description: Spec is the container spec
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                      required:
                      - name
                      - spec
                      type: object
                    runsOn:
                      description: |-
                        RunsOn specifies the agents that can run this action.
                        When left empty, the action will run on the main instance itself.
                      items:
                        type: string
                      type: array
                    sql:
                      properties:
                        connection:
                          description: Connection identifier e.g. connection://Postgres/flanksource
                          type: string
                        driver:
                          description: |-
                            Driver is the name of the underlying database to connect to.
                            Example: postgres, mysql, ...
                          type: string
                        query:
                          description: Query is the sql query to run
                          type: string
                        url:
                          description: URL is the database connection url
                          type: string
                      required:
                      - driver
                      - query
                      type: object
                    templatesOn:
                      description: |-
                        TemplatesOn specifies where the templating happens.
                        Available options:
                         - host
                         - agent
                        When left empty, the templating is done on the main instance(host) itself.
                      type: string
                    timeout:
                      description: Timeout is the maximum duration to let an action
                        run before it's cancelled.
                      type: string
                  required:
                  - name
                  type: object
                type: array
              approval:
                description: Approval defines the individuals and teams authorized
                  to approve runs of this playbook.
                properties:
                  approvers:
                    properties:
                      people:
                        description: Emails of the approvers
                        items:
                          type: string
                        type: array
                      teams:
                        description: Names of the teams
                        items:
                          type: string
                        type: array
                    type: object
                  type:
                    type: string
                type: object
              category:
                type: string
              checks:
                description: Checks filters what checks can run on this playbook.
                items:
                  properties:
                    agent:
                      description: |-
                        Agent can be the agent id or the name of the agent.
                         Additionally, the special "self" value can be used to select resources without an agent.
                      type: string
                    cache:
                      description: |-
                        Cache directives
                         'no-cache' (should not fetch from cache but can be cached)
                         'no-store' (should not cache)
                         'max-age=X' (cache for X duration)
                      type: string
                    fieldSelector:
                      type: string
                    health:
                      description: |-
                        Health filters resources by the health.
                        Multiple healths can be provided separated by comma.
                      type: string
                    id:
                      type: string
                    includeDeleted:
                      type: boolean
                    labelSelector:
                      type: string
                    limit:
                      type: integer
                    name:
                      type: string
                    namespace:
                      type: string
                    scope:
                      description: |-
                        Scope is the reference for parent of the resource to select.
                        For config items, the scope is the scraper id
                        For checks, it's canaries and
                        For components, it's topology.
                        It can either be a uuid or namespace/name
                      type: string
                    search:
                      description: Search query that applies to the resource name,
                        tag & labels.
                      type: string
                    statuses:
                      description: Statuses filter resources by the status
                      items:
                        type: string
                      type: array
                    tagSelector:
                      type: string
                    types:
                      description: Types filter resources by the type
                      items:
                        type: string
                      type: array
                  type: object
                type: array
              components:
                description: Components what components can run on this playbook.
                items:
                  properties:
                    agent:
                      description: |-
                        Agent can be the agent id or the name of the agent.
                         Additionally, the special "self" value can be used to select resources without an agent.
                      type: string
                    cache:
                      description: |-
                        Cache directives
                         'no-cache' (should not fetch from cache but can be cached)
                         'no-store' (should not cache)
                         'max-age=X' (cache for X duration)
                      type: string
                    fieldSelector:
                      type: string
                    health:
                      description: |-
                        Health filters resources by the health.
                        Multiple healths can be provided separated by comma.
                      type: string
                    id:
                      type: string
                    includeDeleted:
                      type: boolean
                    labelSelector:
                      type: string
                    limit:
                      type: integer
                    name:
                      type: string
                    namespace:
                      type: string
                    scope:
                      description: |-
                        Scope is the reference for parent of the resource to select.
                        For config items, the scope is the scraper id
                        For checks, it's canaries and
                        For components, it's topology.
                        It can either be a uuid or namespace/name
                      type: string
                    search:
                      description: Search query that applies to the resource name,
                        tag & labels.
                      type: string
                    statuses:
                      description: Statuses filter resources by the status
                      items:
                        type: string
                      type: array
                    tagSelector:
                      type: string
                    types:
                      description: Types filter resources by the type
                      items:
                        type: string
                      type: array
                  type: object
                type: array
              configs:
                description: Configs filters what config items can run on this playbook.
                items:
                  properties:
                    agent:
                      description: |-
                        Agent can be the agent id or the name of the agent.
                         Additionally, the special "self" value can be used to select resources without an agent.
                      type: string
                    cache:
                      description: |-
                        Cache directives
                         'no-cache' (should not fetch from cache but can be cached)
                         'no-store' (should not cache)
                         'max-age=X' (cache for X duration)
                      type: string
                    fieldSelector:
                      type: string
                    health:
                      description: |-
                        Health filters resources by the health.
                        Multiple healths can be provided separated by comma.
                      type: string
                    id:
                      type: string
                    includeDeleted:
                      type: boolean
                    labelSelector:
                      type: string
                    limit:
                      type: integer
                    name:
                      type: string
                    namespace:
                      type: string
                    scope:
                      description: |-
                        Scope is the reference for parent of the resource to select.
                        For config items, the scope is the scraper id
                        For checks, it's canaries and
                        For components, it's topology.
                        It can either be a uuid or namespace/name
                      type: string
                    search:
                      description: Search query that applies to the resource name,
                        tag & labels.
                      type: string
                    statuses:
                      description: Statuses filter resources by the status
                      items:
                        type: string
                      type: array
                    tagSelector:
                      type: string
                    types:
                      description: Types filter resources by the type
                      items:
                        type: string
                      type: array
                  type: object
                type: array
              description:
                description: Short description of the playbook.
                type: string
              env:
                description: |-
                  Env is a list of env vars that are templatable and accessible in templates.
                  Env vars are similar to playbook parameters except they do not get
                  persisted and are meant to be used for confidential information.
                items:
                  properties:
                    name:
                      type: string
                    value:
                      type: string
                    valueFrom:
                      properties:
                        configMapKeyRef:
                          properties:
                            key:
                              type: string
                            name:
                              type: string
                          required:
                          - key
                          type: object
                        helmRef:
                          properties:
                            key:
                              description: Key is a JSONPath expression used to fetch
                                the key from the merged JSON.
                              type: string
                            name:
                              type: string
                          required:
                          - key
                          type: object
                        secretKeyRef:
                          properties:
                            key:
                              type: string
                            name:
                              type: string
                          required:
                          - key
                          type: object
                        serviceAccount:
                          description: ServiceAccount specifies the service account
                            whose token should be fetched
                          type: string
                      type: object
                  type: object
                type: array
              filters:
                description: CEL Expressions that check if a playbook should be executed
                items:
                  type: string
                type: array
              icon:
                type: string
              "on":
                description: |-
                  `On` defines triggers that will automatically trigger the playbook.
                  If multiple events are defined, only one of those events needs to occur to trigger the playbook.
                  If multiple triggering events occur at the same time, multiple playbook runs will be triggered.
                properties:
                  canary:
                    items:
                      properties:
                        event:
                          description: Event to listen for.
                          type: string
                        filter:
                          description: CEL expression for additional event filtering.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: Labels specifies the key-value pairs that the
                            associated event's resource must match.
                          type: object
                      required:
                      - event
                      type: object
                    type: array
                  component:
                    items:
                      properties:
                        event:
                          description: Event to listen for.
                          type: string
                        filter:
                          description: CEL expression for additional event filtering.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: Labels specifies the key-value pairs that the
                            associated event's resource must match.
                          type: object
                      required:
                      - event
                      type: object
                    type: array
                  config:
                    items:
                      properties:
                        event:
                          description: Event to listen for.
                          type: string
                        filter:
                          description: CEL expression for additional event filtering.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: Labels specifies the key-value pairs that the
                            associated event's resource must match.
                          type: object
                      required:
                      - event
                      type: object
                    type: array
                  webhook:
                    description: Webhook creates a new endpoint that triggers this
                      playbook
                    properties:
                      authentication:
                        properties:
                          basic:
                            properties:
                              password:
                                properties:
                                  name:
                                    type: string
                                  value:
                                    type: string
                                  valueFrom:
                                    properties:
                                      configMapKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      helmRef:
                                        properties:
                                          key:
                                            description: Key is a JSONPath expression
                                              used to fetch the key from the merged
                                              JSON.
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      secretKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      serviceAccount:
                                        description: ServiceAccount specifies the
                                          service account whose token should be fetched
                                        type: string
                                    type: object
                                type: object
                              username:
                                properties:
                                  name:
                                    type: string
                                  value:
                                    type: string
                                  valueFrom:
                                    properties:
                                      configMapKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      helmRef:
                                        properties:
                                          key:
                                            description: Key is a JSONPath expression
                                              used to fetch the key from the merged
                                              JSON.
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      secretKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      serviceAccount:
                                        description: ServiceAccount specifies the
                                          service account whose token should be fetched
                                        type: string
                                    type: object
                                type: object
                            required:
                            - password
                            - username
                            type: object
                          github:
                            properties:
                              token:
                                description: |-
                                  Token is the secret token for the webhook.
                                   Doc: https://docs.github.com/en/webhooks/using-webhooks/validating-webhook-deliveries
                                properties:
                                  name:
                                    type: string
                                  value:
                                    type: string
                                  valueFrom:
                                    properties:
                                      configMapKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      helmRef:
                                        properties:
                                          key:
                                            description: Key is a JSONPath expression
                                              used to fetch the key from the merged
                                              JSON.
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      secretKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      serviceAccount:
                                        description: ServiceAccount specifies the
                                          service account whose token should be fetched
                                        type: string
                                    type: object
                                type: object
                            required:
                            - token
                            type: object
                          jwt:
                            properties:
                              jwksUri:
                                type: string
                            required:
                            - jwksUri
                            type: object
                          svix:
                            properties:
                              secret:
                                description: Secret is the webhook signing secret
                                properties:
                                  name:
                                    type: string
                                  value:
                                    type: string
                                  valueFrom:
                                    properties:
                                      configMapKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      helmRef:
                                        properties:
                                          key:
                                            description: Key is a JSONPath expression
                                              used to fetch the key from the merged
                                              JSON.
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      secretKeyRef:
                                        properties:
                                          key:
                                            type: string
                                          name:
                                            type: string
                                        required:
                                        - key
                                        type: object
                                      serviceAccount:
                                        description: ServiceAccount specifies the
                                          service account whose token should be fetched
                                        type: string
                                    type: object
                                type: object
                              verifyTimestamp:
                                description: |-
                                  TimestampTolerance specifies the tolerance for the timestamp verification.
                                  Valid time units are "ns", "us" (or "s"), "ms", "s", "m", "h", "d", "w", "y".
                                type: string
                            required:
                            - secret
                            type: object
                        type: object
                      path:
                        type: string
                    required:
                    - path
                    type: object
                type: object
              parameters:
                description: Define and document what parameters are required to run
                  this playbook.
                items:
                  description: PlaybookParameter defines a parameter that a playbook
                    needs to run.
                  properties:
                    default:
                      description: Specify the default value of the parameter.
                      type: string
                    dependsOn:
                      description: DependsOn lists the parameters that influence this
                        parameter's default values.
                      items:
                        type: string
                      type: array
                    description:
                      type: string
                    icon:
                      type: string
                    label:
                      description: Label shown on the UI
                      type: string
                    name:
                      description: |-
                        Name is the key for this parameter.
                        It's used to address the parameter on templates.
                      type: string
                    properties:
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    required:
                      type: boolean
                    type:
                      enum:
                      - check
                      - checkbox
                      - code
                      - component
                      - config
                      - list
                      - people
                      - team
                      - text
                      - bytes
                      - millicores
                      type: string
                  required:
                  - name
                  type: object
                type: array
              permissions:
                description: Permissions ...
                items:
                  properties:
                    ref:
                      type: string
                    role:
                      type: string
                    team:
                      type: string
                  type: object
                type: array
              runsOn:
                description: |-
                  RunsOn specifies the agents that can run this playbook.
                  When left empty, the playbook will run on the main instance itself.
                items:
                  type: string
                type: array
              templatesOn:
                description: |-
                  TemplatesOn specifies where the templating happens.
                  Available options:
                   - host
                   - agent
                  When left empty, the templating is done on the main instance(host) itself.
                type: string
              title:
                type: string
            required:
            - actions
            type: object
          status:
            description: PlaybookStatus defines the observed state of Playbook
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
