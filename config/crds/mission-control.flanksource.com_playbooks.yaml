---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.11.1
  creationTimestamp: null
  name: playbooks.mission-control.flanksource.com
spec:
  group: mission-control.flanksource.com
  names:
    kind: Playbook
    listKind: PlaybookList
    plural: playbooks
    singular: playbook
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: Playbook is the schema for the Playbooks API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            properties:
              actions:
                description: List of actions that need to be executed by this playbook.
                items:
                  properties:
                    delay:
                      description: Delay is the duration to delay the execution of
                        this action. The least supported value as of now is 1m.
                      type: string
                    exec:
                      properties:
                        connections:
                          properties:
                            aws:
                              properties:
                                accessKey:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                      type: object
                                  type: object
                                connection:
                                  description: ConnectionName of the connection. It'll
                                    be used to populate the endpoint, accessKey and
                                    secretKey.
                                  type: string
                                endpoint:
                                  type: string
                                objectPath:
                                  description: glob path to restrict matches to a
                                    subset
                                  type: string
                                region:
                                  type: string
                                secretKey:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                      type: object
                                  type: object
                                sessionToken:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                      type: object
                                  type: object
                                skipTLSVerify:
                                  description: Skip TLS verify when connecting to
                                    aws
                                  type: boolean
                                usePathStyle:
                                  description: 'Use path style path: http://s3.amazonaws.com/BUCKET/KEY
                                    instead of http://BUCKET.s3.amazonaws.com/KEY'
                                  type: boolean
                              type: object
                            azure:
                              properties:
                                clientID:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                      type: object
                                  type: object
                                clientSecret:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                      type: object
                                  type: object
                                connection:
                                  type: string
                                tenantID:
                                  type: string
                              type: object
                            gcp:
                              properties:
                                connection:
                                  description: ConnectionName of the connection. It'll
                                    be used to populate the endpoint and credentials.
                                  type: string
                                credentials:
                                  properties:
                                    name:
                                      type: string
                                    value:
                                      type: string
                                    valueFrom:
                                      properties:
                                        configMapKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                        secretKeyRef:
                                          properties:
                                            key:
                                              type: string
                                            name:
                                              type: string
                                          required:
                                          - key
                                          type: object
                                      type: object
                                  type: object
                                endpoint:
                                  type: string
                              type: object
                          type: object
                        script:
                          description: Script can be a inline script or a path to
                            a script that needs to be executed On windows executed
                            via powershell and in darwin and linux executed using
                            bash
                          type: string
                      required:
                      - script
                      type: object
                    http:
                      properties:
                        body:
                          description: Request Body Contents
                          type: string
                        connection:
                          description: Connection name e.g. connection://http/google
                          type: string
                        headers:
                          description: Header fields to be used in the query
                          items:
                            properties:
                              name:
                                type: string
                              value:
                                type: string
                              valueFrom:
                                properties:
                                  configMapKeyRef:
                                    properties:
                                      key:
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                  secretKeyRef:
                                    properties:
                                      key:
                                        type: string
                                      name:
                                        type: string
                                    required:
                                    - key
                                    type: object
                                type: object
                            type: object
                          type: array
                        method:
                          description: Method to use - defaults to GET
                          type: string
                        ntlm:
                          description: NTLM when set to true will do authentication
                            using NTLM v1 protocol
                          type: boolean
                        ntlmv2:
                          description: NTLM when set to true will do authentication
                            using NTLM v2 protocol
                          type: boolean
                        password:
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                              type: object
                          type: object
                        templateBody:
                          description: TemplateBody controls whether the body of the
                            request needs to be templated
                          type: boolean
                        url:
                          description: Connection url, interpolated with username,password
                          type: string
                        username:
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                  required:
                                  - key
                                  type: object
                              type: object
                          type: object
                      type: object
                    name:
                      description: Name of the action
                      type: string
                    pod:
                      properties:
                        maxLength:
                          description: 'MaxLength is the maximum length of the logs
                            to show Default: 3000 characters'
                          type: integer
                        name:
                          description: Name is name of the pod that'll be created
                          type: string
                        spec:
                          description: Spec is the container spec
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                      required:
                      - name
                      - spec
                      type: object
                    sql:
                      properties:
                        connection:
                          description: Connection identifier e.g. connection://Postgres/flanksource
                          type: string
                        driver:
                          description: 'Driver is the name of the underlying database
                            to connect to. Example: postgres, mysql, ...'
                          type: string
                        query:
                          description: Query is the sql query to run
                          type: string
                        url:
                          description: URL is the database connection url
                          type: string
                      required:
                      - driver
                      - query
                      type: object
                    timeout:
                      description: Timeout is the maximum duration to let an action
                        run before it's cancelled.
                      type: string
                  required:
                  - name
                  type: object
                type: array
              approval:
                description: Approval defines the individuals and teams authorized
                  to approve runs of this playbook.
                properties:
                  approvers:
                    properties:
                      people:
                        description: Emails of the approvers
                        items:
                          type: string
                        type: array
                      teams:
                        description: Names of the teams
                        items:
                          type: string
                        type: array
                    type: object
                  type:
                    type: string
                type: object
              checks:
                description: Checks filters what checks can run on this playbook.
                items:
                  description: PlaybookResourceFilter defines a filter that decides
                    whether a resource (config or a component) is permitted be run
                    on the Playbook.
                  properties:
                    tags:
                      additionalProperties:
                        type: string
                      type: object
                    type:
                      type: string
                  type: object
                type: array
              components:
                description: Components what components can run on this playbook.
                items:
                  description: PlaybookResourceFilter defines a filter that decides
                    whether a resource (config or a component) is permitted be run
                    on the Playbook.
                  properties:
                    tags:
                      additionalProperties:
                        type: string
                      type: object
                    type:
                      type: string
                  type: object
                type: array
              configs:
                description: Configs filters what config items can run on this playbook.
                items:
                  description: PlaybookResourceFilter defines a filter that decides
                    whether a resource (config or a component) is permitted be run
                    on the Playbook.
                  properties:
                    tags:
                      additionalProperties:
                        type: string
                      type: object
                    type:
                      type: string
                  type: object
                type: array
              description:
                description: Short description of the playbook.
                type: string
              "on":
                description: '`On` defines events that will automatically trigger
                  the playbook. If multiple events are defined, only one of those
                  events needs to occur to trigger the playbook. If multiple triggering
                  events occur at the same time, multiple playbook runs will be triggered.'
                properties:
                  canary:
                    items:
                      properties:
                        event:
                          description: Event to listen for.
                          type: string
                        filter:
                          description: CEL expression for additional event filtering.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: Labels specifies the key-value pairs that the
                            associated event's resource must match.
                          type: object
                      required:
                      - event
                      type: object
                    type: array
                  component:
                    items:
                      properties:
                        event:
                          description: Event to listen for.
                          type: string
                        filter:
                          description: CEL expression for additional event filtering.
                          type: string
                        labels:
                          additionalProperties:
                            type: string
                          description: Labels specifies the key-value pairs that the
                            associated event's resource must match.
                          type: object
                      required:
                      - event
                      type: object
                    type: array
                type: object
              parameters:
                description: Define and document what parameters are required to run
                  this playbook.
                items:
                  description: PlaybookParameter defines a parameter that a playbook
                    needs to run.
                  properties:
                    label:
                      type: string
                    name:
                      type: string
                  required:
                  - label
                  - name
                  type: object
                type: array
              permissions:
                description: Permissions ...
                items:
                  properties:
                    ref:
                      type: string
                    role:
                      type: string
                    team:
                      type: string
                  type: object
                type: array
            required:
            - actions
            type: object
          status:
            description: PlaybookStatus defines the observed state of Playbook
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
