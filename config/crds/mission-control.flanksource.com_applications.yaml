---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: applications.mission-control.flanksource.com
spec:
  group: mission-control.flanksource.com
  names:
    kind: Application
    listKind: ApplicationList
    plural: applications
    singular: application
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: Application is the Schema for the applications API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              description:
                description: Description of the application
                type: string
              mapping:
                properties:
                  accessReviews:
                    description: |-
                      AccessReviews selects config items whose config_analysis records (security findings, misconfigurations, etc.)
                      must be shown in the application's Findings panel.
                    items:
                      properties:
                        agent:
                          description: |-
                            Agent can be the agent id or the name of the agent.
                             Additionally, the special "self" value can be used to select resources without an agent.
                          type: string
                        cache:
                          description: |-
                            Cache directives
                             'no-cache' (should not fetch from cache but can be cached)
                             'no-store' (should not cache)
                             'max-age=X' (cache for X duration)
                          type: string
                        fieldSelector:
                          type: string
                        health:
                          description: |-
                            Health filters resources by the health.
                            Multiple healths can be provided separated by comma.
                          type: string
                        id:
                          type: string
                        includeDeleted:
                          type: boolean
                        labelSelector:
                          type: string
                        limit:
                          type: integer
                        name:
                          type: string
                        namespace:
                          type: string
                        scope:
                          description: |-
                            Scope is the reference for parent of the resource to select.
                            For config items, the scope is the scraper id
                            For checks, it's canaries and
                            For components, it's topology.
                            It can either be a uuid or namespace/name
                          type: string
                        search:
                          description: Search query that applies to the resource name,
                            tag & labels.
                          type: string
                        statuses:
                          description: Statuses filter resources by the status
                          items:
                            type: string
                          type: array
                        tagSelector:
                          type: string
                        types:
                          description: Types filter resources by the type
                          items:
                            type: string
                          type: array
                      type: object
                    type: array
                  datasources:
                    description: |-
                      Datasources selects config items that represent data sources (e.g. databases,
                      object stores) whose backup and restore activity should be tracked.

                      The system queries config_changes on the matched config items for the following
                      change types and surfaces them in the application's Backups / Restores panels:
                        Backups:  BackupCompleted, BackupEnqueued, BackupFailed, BackupRunning,
                                  BackupStarted, BackupSuccessful
                        Restores: BackupRestored, RestoreCompleted
                    items:
                      properties:
                        agent:
                          description: |-
                            Agent can be the agent id or the name of the agent.
                             Additionally, the special "self" value can be used to select resources without an agent.
                          type: string
                        cache:
                          description: |-
                            Cache directives
                             'no-cache' (should not fetch from cache but can be cached)
                             'no-store' (should not cache)
                             'max-age=X' (cache for X duration)
                          type: string
                        fieldSelector:
                          type: string
                        health:
                          description: |-
                            Health filters resources by the health.
                            Multiple healths can be provided separated by comma.
                          type: string
                        id:
                          type: string
                        includeDeleted:
                          type: boolean
                        labelSelector:
                          type: string
                        limit:
                          type: integer
                        name:
                          type: string
                        namespace:
                          type: string
                        scope:
                          description: |-
                            Scope is the reference for parent of the resource to select.
                            For config items, the scope is the scraper id
                            For checks, it's canaries and
                            For components, it's topology.
                            It can either be a uuid or namespace/name
                          type: string
                        search:
                          description: Search query that applies to the resource name,
                            tag & labels.
                          type: string
                        statuses:
                          description: Statuses filter resources by the status
                          items:
                            type: string
                          type: array
                        tagSelector:
                          type: string
                        types:
                          description: Types filter resources by the type
                          items:
                            type: string
                          type: array
                      type: object
                    type: array
                  environments:
                    additionalProperties:
                      items:
                        properties:
                          agent:
                            description: |-
                              Agent can be the agent id or the name of the agent.
                               Additionally, the special "self" value can be used to select resources without an agent.
                            type: string
                          cache:
                            description: |-
                              Cache directives
                               'no-cache' (should not fetch from cache but can be cached)
                               'no-store' (should not cache)
                               'max-age=X' (cache for X duration)
                            type: string
                          fieldSelector:
                            type: string
                          health:
                            description: |-
                              Health filters resources by the health.
                              Multiple healths can be provided separated by comma.
                            type: string
                          id:
                            type: string
                          includeDeleted:
                            type: boolean
                          labelSelector:
                            type: string
                          limit:
                            type: integer
                          name:
                            type: string
                          namespace:
                            type: string
                          purpose:
                            description: |-
                              Purpose describes the role of this environment within the application deployment.
                              e.g. "primary", "backup", "dr" (disaster recovery)
                            type: string
                          scope:
                            description: |-
                              Scope is the reference for parent of the resource to select.
                              For config items, the scope is the scraper id
                              For checks, it's canaries and
                              For components, it's topology.
                              It can either be a uuid or namespace/name
                            type: string
                          search:
                            description: Search query that applies to the resource
                              name, tag & labels.
                            type: string
                          statuses:
                            description: Statuses filter resources by the status
                            items:
                              type: string
                            type: array
                          tagSelector:
                            type: string
                          types:
                            description: Types filter resources by the type
                            items:
                              type: string
                            type: array
                        required:
                        - purpose
                        type: object
                      type: array
                    description: |-
                      Environments maps an environment name (e.g. "Production", "Staging") to one or
                      more selectors that identify the infrastructure config items belonging to that
                      environment
                    type: object
                  logins:
                    description: |-
                      Logins selects config items whose config access and access logs must be tracked by this application.

                      This field has two effects:

                      1. Read path — the matched config items' access control are read and displayed.

                      2. Sync path (Azure only) — if the scraper that originally ingested the matched
                         config items is an Azure scraper, it is cloned into a new application-scoped
                         scraper reconfigured to scrape only Entra AppRoleAssignments (scoped to the
                         matched items), keeping role assignment data fresh.
                    items:
                      properties:
                        agent:
                          description: |-
                            Agent can be the agent id or the name of the agent.
                             Additionally, the special "self" value can be used to select resources without an agent.
                          type: string
                        cache:
                          description: |-
                            Cache directives
                             'no-cache' (should not fetch from cache but can be cached)
                             'no-store' (should not cache)
                             'max-age=X' (cache for X duration)
                          type: string
                        fieldSelector:
                          type: string
                        health:
                          description: |-
                            Health filters resources by the health.
                            Multiple healths can be provided separated by comma.
                          type: string
                        id:
                          type: string
                        includeDeleted:
                          type: boolean
                        labelSelector:
                          type: string
                        limit:
                          type: integer
                        name:
                          type: string
                        namespace:
                          type: string
                        scope:
                          description: |-
                            Scope is the reference for parent of the resource to select.
                            For config items, the scope is the scraper id
                            For checks, it's canaries and
                            For components, it's topology.
                            It can either be a uuid or namespace/name
                          type: string
                        search:
                          description: Search query that applies to the resource name,
                            tag & labels.
                          type: string
                        statuses:
                          description: Statuses filter resources by the status
                          items:
                            type: string
                          type: array
                        tagSelector:
                          type: string
                        types:
                          description: Types filter resources by the type
                          items:
                            type: string
                          type: array
                      type: object
                    type: array
                  roles:
                    description: |-
                      Roles maps external config items (e.g. Entra groups, IAM roles) to a named role
                      within this application, so that group memberships from external systems are
                      surfaced as human-readable roles in the application's AccessControl view.
                    items:
                      properties:
                        agent:
                          description: |-
                            Agent can be the agent id or the name of the agent.
                             Additionally, the special "self" value can be used to select resources without an agent.
                          type: string
                        cache:
                          description: |-
                            Cache directives
                             'no-cache' (should not fetch from cache but can be cached)
                             'no-store' (should not cache)
                             'max-age=X' (cache for X duration)
                          type: string
                        fieldSelector:
                          type: string
                        health:
                          description: |-
                            Health filters resources by the health.
                            Multiple healths can be provided separated by comma.
                          type: string
                        id:
                          type: string
                        includeDeleted:
                          type: boolean
                        labelSelector:
                          type: string
                        limit:
                          type: integer
                        name:
                          type: string
                        namespace:
                          type: string
                        role:
                          description: Assign a name for the role
                          type: string
                        scope:
                          description: |-
                            Scope is the reference for parent of the resource to select.
                            For config items, the scope is the scraper id
                            For checks, it's canaries and
                            For components, it's topology.
                            It can either be a uuid or namespace/name
                          type: string
                        search:
                          description: Search query that applies to the resource name,
                            tag & labels.
                          type: string
                        statuses:
                          description: Statuses filter resources by the status
                          items:
                            type: string
                          type: array
                        tagSelector:
                          type: string
                        types:
                          description: Types filter resources by the type
                          items:
                            type: string
                          type: array
                      required:
                      - role
                      type: object
                    type: array
                type: object
              properties:
                description: Properties to be displayed in the application view
                items:
                  properties:
                    color:
                      type: string
                    icon:
                      type: string
                    label:
                      type: string
                    links:
                      items:
                        properties:
                          icon:
                            type: string
                          label:
                            type: string
                          text:
                            type: string
                          tooltip:
                            type: string
                          type:
                            description: e.g. documentation, support, playbook
                            type: string
                          url:
                            type: string
                        type: object
                      type: array
                    name:
                      type: string
                    order:
                      type: integer
                    text:
                      type: string
                    tooltip:
                      type: string
                    type:
                      type: string
                    unit:
                      description: e.g. milliseconds, bytes, millicores, epoch etc.
                      type: string
                    value:
                      format: int64
                      type: integer
                  type: object
                type: array
              sections:
                items:
                  description: ViewSection is a section rendered in the application
                    view
                  properties:
                    icon:
                      type: string
                    title:
                      type: string
                    uiRef:
                      description: UIRef references a native Flanksource UI component
                        (changes or configs)
                      properties:
                        changes:
                          description: |-
                            ChangesUIFilters defines filters for the native Changes UI component.
                            Uses standard formats: Kubernetes-style tag selectors, comma-separated values.
                            Frontend is responsible for translating to its internal format.
                          properties:
                            changeType:
                              type: string
                            configTypes:
                              type: string
                            createdBy:
                              type: string
                            from:
                              type: string
                            severity:
                              type: string
                            source:
                              type: string
                            summary:
                              type: string
                            tags:
                              type: string
                            to:
                              type: string
                          type: object
                        configs:
                          description: |-
                            ConfigsUIFilters defines filters for the native Configs UI component.
                            Uses standard formats: Kubernetes-style label selectors, comma-separated values.
                            Frontend is responsible for translating to its internal format.
                          properties:
                            configType:
                              type: string
                            health:
                              type: string
                            labels:
                              type: string
                            search:
                              type: string
                            status:
                              type: string
                          type: object
                      type: object
                    viewRef:
                      properties:
                        name:
                          type: string
                        namespace:
                          type: string
                      required:
                      - name
                      - namespace
                      type: object
                  required:
                  - title
                  type: object
                type: array
              type:
                description: Type of the application
                type: string
            required:
            - type
            type: object
          status:
            description: ApplicationStatus defines the observed state of Application
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
