openapi: 3.1.0
info:
  title: Mission Control API (Full)
  description: |
    Mission Control (incident-commander) complete REST API including native endpoints
    and proxy endpoints for PostgREST, Kratos, Canary Checker, Config DB, and Kubernetes.

    This specification includes all routes. For the core API without proxy endpoints,
    see `openapi.yaml`.
  version: 1.0.0
  contact:
    name: Flanksource
    url: https://flanksource.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  - url: /
    description: Current server

tags:
  - name: Health
    description: Health and system status endpoints
  - name: Authentication
    description: User authentication and token management
  - name: RBAC
    description: Role-based access control
  - name: Agents
    description: Agent management and token generation
  - name: Playbooks
    description: Playbook execution and management
  - name: Catalog
    description: Configuration catalog and changes
  - name: Notifications
    description: Notification management and silencing
  - name: Views
    description: Custom view management
  - name: Artifacts
    description: Artifact storage and retrieval
  - name: Connections
    description: Connection testing and management
  - name: Search
    description: Resource search
  - name: People
    description: Person management
  - name: Kubernetes
    description: Kubernetes integration
  - name: Applications
    description: Application information
  - name: Logs
    description: Log retrieval
  - name: Database (PostgREST)
    description: |
      PostgREST proxy - Direct database REST API access.
      See [PostgREST Documentation](https://postgrest.org/en/stable/api.html)
  - name: Auth (Kratos)
    description: |
      Ory Kratos proxy - Identity management.
      See [Kratos API Reference](https://www.ory.sh/docs/kratos/reference/api)
  - name: Canary
    description: |
      Canary Checker proxy - Health check management.
      See [Canary Checker](https://github.com/flanksource/canary-checker)
  - name: Config
    description: |
      Config DB proxy - Configuration scraping and management.
      See [Config DB](https://github.com/flanksource/config-db)
  - name: Kubernetes Proxy
    description: Kubernetes API proxy for cluster access
  - name: Debug
    description: |
      Debug and monitoring endpoints. Some endpoints (pprof) are restricted to localhost only.
      Requires monitor:update permission.

security:
  - BearerAuth: []

paths:
  # ============================================================================
  # NATIVE ENDPOINTS (same as openapi.yaml)
  # ============================================================================

  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Returns health status of the service
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /metrics:
    get:
      tags: [Health]
      summary: Prometheus metrics
      description: Returns Prometheus-formatted metrics
      security: []
      responses:
        '200':
          description: Metrics in Prometheus format
          content:
            text/plain:
              schema:
                type: string

  /properties:
    get:
      tags: [Health]
      summary: System properties
      description: Returns system and database properties
      responses:
        '200':
          description: List of properties
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Property'

  # Authentication endpoints
  /auth/{id}/update_state:
    post:
      tags: [Authentication]
      summary: Update account state
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [state]
              properties:
                state:
                  type: string
                  enum: [active, inactive]
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/{id}/properties:
    post:
      tags: [Authentication]
      summary: Update account properties
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonProperties'
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/whoami:
    get:
      tags: [Authentication]
      summary: Get current user
      responses:
        '200':
          description: Current user information
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/HTTPSuccess'
                  - type: object
                    properties:
                      payload:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/Person'
                          roles:
                            type: array
                            items:
                              type: string
                          permissions:
                            type: array
                            items:
                              $ref: '#/components/schemas/Permission'
                          hostname:
                            type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/create_token:
    post:
      tags: [Authentication]
      summary: Create access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTokenRequest'
      responses:
        '200':
          description: Token created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/HTTPSuccess'
                  - type: object
                    properties:
                      payload:
                        type: object
                        properties:
                          token:
                            type: string

  /auth/tokens:
    get:
      tags: [Authentication]
      summary: List access tokens
      responses:
        '200':
          description: List of tokens
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/HTTPSuccess'
                  - type: object
                    properties:
                      payload:
                        type: array
                        items:
                          $ref: '#/components/schemas/AccessToken'

  /auth/token/{id}:
    delete:
      tags: [Authentication]
      summary: Delete access token
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'
        '403':
          $ref: '#/components/responses/Forbidden'

  # RBAC endpoints
  /rbac/{id}/update_role:
    post:
      tags: [RBAC]
      summary: Update roles for user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [roles]
              properties:
                roles:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'

  /rbac/dump:
    get:
      tags: [RBAC]
      summary: Dump RBAC policies
      responses:
        '200':
          description: List of permissions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Permission'

  /rbac/{id}/roles:
    get:
      tags: [RBAC]
      summary: Get roles for user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User roles
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/HTTPSuccess'
                  - type: object
                    properties:
                      payload:
                        type: array
                        items:
                          type: string

  /rbac/token/{id}/permissions:
    get:
      tags: [RBAC]
      summary: Get permissions for token
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Token permissions
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/HTTPSuccess'
                  - type: object
                    properties:
                      payload:
                        type: array
                        items:
                          $ref: '#/components/schemas/Permission'

  # Agent endpoints
  /agent/generate:
    post:
      tags: [Agents]
      summary: Generate new agent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateAgentRequest'
      responses:
        '201':
          description: Agent created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratedAgent'

  /agent/token:
    post:
      tags: [Agents]
      summary: Generate agent token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateTokenRequest'
      responses:
        '201':
          description: Token generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratedToken'

  # Playbook endpoints
  /playbook/list:
    get:
      tags: [Playbooks]
      summary: List playbooks
      parameters:
        - name: config_id
          in: query
          schema:
            type: string
            format: uuid
        - name: check_id
          in: query
          schema:
            type: string
            format: uuid
        - name: component_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of playbooks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PlaybookListItem'

  /playbook/webhook/{webhook_path}:
    post:
      tags: [Playbooks]
      summary: Trigger playbook via webhook
      security:
        - {}
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: webhook_path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook processed

  /playbook/{id}/params:
    post:
      tags: [Playbooks]
      summary: Get playbook parameters
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunParams'
      responses:
        '200':
          description: Playbook parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetParamsResponse'

  /playbook/events:
    get:
      tags: [Playbooks]
      summary: Get playbook events
      responses:
        '200':
          description: List of events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'

  /playbook/run:
    post:
      tags: [Playbooks]
      summary: Run playbook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunParams'
      responses:
        '201':
          description: Playbook run started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunResponse'

  /playbook/run/{id}:
    get:
      tags: [Playbooks]
      summary: Get playbook run
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Playbook run details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybookRun'

  /playbook/run/approve/{run_id}:
    post:
      tags: [Playbooks]
      summary: Approve playbook run
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'

  /playbook/run/cancel/{run_id}:
    post:
      tags: [Playbooks]
      summary: Cancel playbook run
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'

  # Catalog endpoints
  /catalog/summary:
    post:
      tags: [Catalog]
      summary: Get config summary
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigSummaryRequest'
      responses:
        '200':
          description: Config summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigSummaryResponse'

  /catalog/changes:
    post:
      tags: [Catalog]
      summary: Search catalog changes
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CatalogChangesSearchRequest'
      responses:
        '200':
          description: Catalog changes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogChangesSearchResponse'

  # Notification endpoints
  /notification/summary:
    post:
      tags: [Notifications]
      summary: Get notification history summary
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationSendHistorySummaryRequest'
      responses:
        '200':
          description: Notification summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSendHistorySummaryResponse'

  /notification/events:
    get:
      tags: [Notifications]
      summary: Get notification events
      responses:
        '200':
          description: List of events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'

  /notification/silence:
    post:
      tags: [Notifications]
      summary: Create notification silence
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SilenceSaveRequest'
      responses:
        '200':
          description: Silence created

  /notification/silence_preview:
    get:
      tags: [Notifications]
      summary: Preview notification silence
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: type
          in: query
          schema:
            type: string
            enum: [config, component, check]
        - name: recursive
          in: query
          schema:
            type: boolean
        - name: filter
          in: query
          schema:
            type: string
        - name: selectors
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Preview of silenced notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationSilencePreviewItem'

  # View endpoints
  /view/list:
    get:
      tags: [Views]
      summary: List views
      parameters:
        - name: config_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of views
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ViewListItem'

  /view/display-plugin-variables/{viewID}:
    get:
      tags: [Views]
      summary: Get display plugin variables
      parameters:
        - name: viewID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: config_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Plugin variables
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string

  /view/{namespace}/{name}:
    get:
      tags: [Views]
      summary: Get view by namespace/name
      parameters:
        - name: namespace
          in: path
          required: true
          schema:
            type: string
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: View result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViewResult'
    post:
      tags: [Views]
      summary: Get view by namespace/name with variables
      parameters:
        - name: namespace
          in: path
          required: true
          schema:
            type: string
        - name: name
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ViewRequestBody'
      responses:
        '200':
          description: View result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViewResult'

  /view/{id}:
    get:
      tags: [Views]
      summary: Get view by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: View result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViewResult'
    post:
      tags: [Views]
      summary: Get view by ID with variables
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ViewRequestBody'
      responses:
        '200':
          description: View result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViewResult'

  # Artifact endpoints
  /artifacts/list/check/{id}/{check_time}:
    get:
      tags: [Artifacts]
      summary: List artifacts for check
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: check_time
          in: path
          required: true
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: List of artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Artifact'

  /artifacts/list/playbook_run/{id}:
    get:
      tags: [Artifacts]
      summary: List artifacts for playbook run
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Artifact'

  /artifacts/download/{id}:
    get:
      tags: [Artifacts]
      summary: Download artifact
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Artifact content
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  # Connection endpoints
  /connection/test/{id}:
    post:
      tags: [Connections]
      summary: Test connection
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'

  # Search endpoints
  /resources/search:
    post:
      tags: [Search]
      summary: Search resources
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchResourcesRequest'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResourcesResponse'

  # People endpoints
  /people/update:
    post:
      tags: [People]
      summary: Update person
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Person'
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'

  /people/{id}:
    delete:
      tags: [People]
      summary: Delete person
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          $ref: '#/components/responses/HTTPSuccess'

  # Kubernetes endpoints
  /kubeconfig:
    get:
      tags: [Kubernetes]
      summary: Download kubeconfig
      parameters:
        - name: cluster
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Kubeconfig file
          content:
            application/x-yaml:
              schema:
                type: string

  # Application endpoints
  /application/{namespace}/{name}:
    get:
      tags: [Applications]
      summary: Get application
      parameters:
        - name: namespace
          in: path
          required: true
          schema:
            type: string
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Application details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Application'

  # Logs endpoints
  /logs:
    post:
      tags: [Logs]
      summary: Query logs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogsRequest'
      responses:
        '200':
          description: Log results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogsResponse'

  # Redirect endpoints
  /redirect/{path}:
    get:
      tags: [Health]
      summary: Short URL redirect
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      responses:
        '302':
          description: Redirect to target URL

  # ============================================================================
  # DEBUG ENDPOINTS
  # ============================================================================

  /debug/routes:
    get:
      tags: [Debug]
      summary: List all registered routes
      description: |
        Returns all registered HTTP routes.

        **RBAC:** Requires monitor:update permission
      responses:
        '200':
          description: List of routes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Route'

  /debug/loggers:
    get:
      tags: [Debug]
      summary: Get logger levels
      description: |
        Returns current logging levels for all named loggers.

        **RBAC:** Requires monitor:update permission
      responses:
        '200':
          description: Logger levels
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
    post:
      tags: [Debug]
      summary: Set logger level
      description: |
        Change logging level for a specific logger.
        If duration is specified, the level will revert after that time.

        **RBAC:** Requires monitor:update permission
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [logger, level]
              properties:
                logger:
                  type: string
                  description: Name of the logger
                level:
                  type: string
                  enum: [trace, debug, info, warn, error]
                duration:
                  type: string
                  description: Duration for temporary change (Go format)
                  example: 5m
      responses:
        '200':
          description: Logger level changed
          content:
            text/plain:
              schema:
                type: string
        '400':
          description: Missing logger name or level

  /debug/properties:
    get:
      tags: [Debug]
      summary: Get supported properties
      description: |
        Returns all supported configuration properties.

        **RBAC:** Requires monitor:update permission
      responses:
        '200':
          description: Supported properties
          content:
            application/json:
              schema:
                type: object

  /debug/system/properties:
    get:
      tags: [Debug]
      summary: Get system properties
      description: |
        Returns all current system property values.

        **RBAC:** Requires monitor:update permission
      responses:
        '200':
          description: System properties
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string

  /debug/property:
    post:
      tags: [Debug]
      summary: Set a property
      description: |
        Sets a system property value.

        **RBAC:** Requires monitor:update permission
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [name, value]
              properties:
                name:
                  type: string
                value:
                  type: string
      responses:
        '200':
          description: Property set
        '400':
          description: Missing property name or value

  /debug/cron:
    get:
      tags: [Debug]
      summary: Get cron job details
      description: |
        Returns details about all scheduled cron jobs.

        **RBAC:** Requires monitor:update permission
      responses:
        '200':
          description: List of cron jobs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CronEntry'

  /debug/cron/run:
    post:
      tags: [Debug]
      summary: Trigger a cron job
      description: |
        Immediately runs a specific cron job by name.

        **RBAC:** Requires monitor:update permission
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  description: Name of the cron job
      responses:
        '201':
          description: Cron job triggered
        '404':
          description: Cron job not found
          content:
            text/plain:
              schema:
                type: string

  /debug/pprof:
    get:
      tags: [Debug]
      summary: pprof index
      description: |
        Go pprof profiling index page.

        **Access:** Restricted to localhost only
      security: []
      responses:
        '200':
          description: pprof index page
          content:
            text/html:
              schema:
                type: string
        '403':
          description: Access restricted to localhost

  /debug/pprof/cmdline:
    get:
      tags: [Debug]
      summary: pprof cmdline
      description: |
        Returns command line used to start the program.

        **Access:** Restricted to localhost only
      security: []
      responses:
        '200':
          description: Command line
          content:
            text/plain:
              schema:
                type: string
        '403':
          description: Access restricted to localhost

  /debug/pprof/profile:
    get:
      tags: [Debug]
      summary: pprof CPU profile
      description: |
        Returns a CPU profile.

        **Access:** Restricted to localhost only
      parameters:
        - name: seconds
          in: query
          schema:
            type: integer
            default: 30
          description: Duration of the profile in seconds
      security: []
      responses:
        '200':
          description: CPU profile
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '403':
          description: Access restricted to localhost

  /debug/pprof/symbol:
    get:
      tags: [Debug]
      summary: pprof symbol lookup
      description: |
        Looks up program symbols.

        **Access:** Restricted to localhost only
      security: []
      responses:
        '200':
          description: Symbol information
          content:
            text/plain:
              schema:
                type: string
        '403':
          description: Access restricted to localhost

  /debug/pprof/trace:
    get:
      tags: [Debug]
      summary: pprof execution trace
      description: |
        Returns an execution trace.

        **Access:** Restricted to localhost only
      parameters:
        - name: seconds
          in: query
          schema:
            type: integer
            default: 1
          description: Duration of the trace in seconds
      security: []
      responses:
        '200':
          description: Execution trace
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '403':
          description: Access restricted to localhost

  # ============================================================================
  # PROXY ENDPOINTS
  # ============================================================================

  /db/{table}:
    get:
      tags: [Database (PostgREST)]
      summary: Query table
      description: |
        PostgREST proxy endpoint. Forwards requests to PostgREST for direct database access.

        See [PostgREST API Documentation](https://postgrest.org/en/stable/api.html) for full details.
      externalDocs:
        description: PostgREST Documentation
        url: https://postgrest.org/en/stable/api.html
      parameters:
        - name: table
          in: path
          required: true
          schema:
            type: string
          description: Database table name
        - name: select
          in: query
          schema:
            type: string
          description: Columns to select
        - name: order
          in: query
          schema:
            type: string
          description: Order by columns
        - name: limit
          in: query
          schema:
            type: integer
          description: Limit results
        - name: offset
          in: query
          schema:
            type: integer
          description: Offset for pagination
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
    post:
      tags: [Database (PostgREST)]
      summary: Insert into table
      description: PostgREST proxy - Insert records
      parameters:
        - name: table
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Record created
    patch:
      tags: [Database (PostgREST)]
      summary: Update table records
      description: PostgREST proxy - Update records
      parameters:
        - name: table
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Records updated
    delete:
      tags: [Database (PostgREST)]
      summary: Delete from table
      description: PostgREST proxy - Delete records
      parameters:
        - name: table
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Records deleted

  /db/rpc/{function}:
    post:
      tags: [Database (PostgREST)]
      summary: Call stored procedure
      description: PostgREST proxy - Call a PostgreSQL function
      parameters:
        - name: function
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Function result
          content:
            application/json:
              schema:
                type: object

  /kratos/{path}:
    get:
      tags: [Auth (Kratos)]
      summary: Kratos API proxy (GET)
      description: |
        Ory Kratos proxy endpoint for identity management.

        See [Kratos API Reference](https://www.ory.sh/docs/kratos/reference/api) for full details.
      externalDocs:
        description: Ory Kratos Documentation
        url: https://www.ory.sh/docs/kratos/reference/api
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Kratos response
    post:
      tags: [Auth (Kratos)]
      summary: Kratos API proxy (POST)
      description: Ory Kratos proxy endpoint
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Kratos response
    put:
      tags: [Auth (Kratos)]
      summary: Kratos API proxy (PUT)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Kratos response
    delete:
      tags: [Auth (Kratos)]
      summary: Kratos API proxy (DELETE)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Kratos response

  /canary/api/topology:
    get:
      tags: [Canary]
      summary: Query topology
      description: |
        Canary Checker topology query endpoint.

        See [Canary Checker](https://github.com/flanksource/canary-checker) for details.
      responses:
        '200':
          description: Topology data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TopologyResponse'

  /canary/api/summary:
    get:
      tags: [Canary]
      summary: Get canary summary (GET)
      description: Canary Checker summary endpoint
      responses:
        '200':
          description: Summary data
    post:
      tags: [Canary]
      summary: Get canary summary (POST)
      description: Canary Checker summary endpoint
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Summary data

  /canary/{path}:
    get:
      tags: [Canary]
      summary: Canary Checker proxy (GET)
      description: |
        Proxy to Canary Checker service.

        See [Canary Checker](https://github.com/flanksource/canary-checker)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Canary Checker response
    post:
      tags: [Canary]
      summary: Canary Checker proxy (POST)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Canary Checker response

  /canary/debug/routes:
    get:
      tags: [Canary]
      summary: Canary Checker registered routes
      description: Returns all registered HTTP routes in Canary Checker.
      responses:
        '200':
          description: List of routes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Route'

  /canary/debug/loggers:
    get:
      tags: [Canary]
      summary: Canary Checker logger levels
      description: Returns current logging levels for Canary Checker.
      responses:
        '200':
          description: Logger levels
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
    post:
      tags: [Canary]
      summary: Set Canary Checker logger level
      description: Change logging level for a Canary Checker logger.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [logger, level]
              properties:
                logger:
                  type: string
                level:
                  type: string
                  enum: [trace, debug, info, warn, error]
                duration:
                  type: string
      responses:
        '200':
          description: Logger level changed
          content:
            text/plain:
              schema:
                type: string
        '400':
          description: Missing logger name or level

  /canary/debug/properties:
    get:
      tags: [Canary]
      summary: Canary Checker supported properties
      description: Returns supported configuration properties for Canary Checker.
      responses:
        '200':
          description: Supported properties
          content:
            application/json:
              schema:
                type: object

  /canary/debug/system/properties:
    get:
      tags: [Canary]
      summary: Canary Checker system properties
      description: Returns current system property values for Canary Checker.
      responses:
        '200':
          description: System properties
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string

  /canary/debug/property:
    post:
      tags: [Canary]
      summary: Set Canary Checker property
      description: Sets a system property value in Canary Checker.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [name, value]
              properties:
                name:
                  type: string
                value:
                  type: string
      responses:
        '200':
          description: Property set
        '400':
          description: Missing property name or value

  /canary/debug/cron:
    get:
      tags: [Canary]
      summary: Canary Checker cron jobs
      description: Returns details about scheduled cron jobs in Canary Checker.
      responses:
        '200':
          description: List of cron jobs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CronEntry'

  /canary/debug/cron/run:
    post:
      tags: [Canary]
      summary: Trigger Canary Checker cron job
      description: Immediately runs a specific cron job in Canary Checker.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
      responses:
        '201':
          description: Cron job triggered
        '404':
          description: Cron job not found

  /canary/debug/pprof:
    get:
      tags: [Canary]
      summary: Canary Checker pprof index
      description: |
        Go pprof profiling index. **Restricted to localhost only.**
      security: []
      responses:
        '200':
          description: pprof index
          content:
            text/html:
              schema:
                type: string
        '403':
          description: Access restricted to localhost

  /canary/debug/pprof/profile:
    get:
      tags: [Canary]
      summary: Canary Checker CPU profile
      description: |
        Returns CPU profile. **Restricted to localhost only.**
      parameters:
        - name: seconds
          in: query
          schema:
            type: integer
            default: 30
      security: []
      responses:
        '200':
          description: CPU profile
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '403':
          description: Access restricted to localhost

  # ============================================================================
  # CONFIG DB PROXY ENDPOINTS
  # ============================================================================

  /config/live:
    get:
      tags: [Config]
      summary: Config DB liveness probe
      description: Returns OK if Config DB service is alive.
      responses:
        '200':
          description: Service is alive
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /config/ready:
    get:
      tags: [Config]
      summary: Config DB readiness probe
      description: Returns OK if Config DB service is ready.
      responses:
        '200':
          description: Service is ready
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /config/metrics:
    get:
      tags: [Config]
      summary: Config DB Prometheus metrics
      description: Returns Prometheus-formatted metrics from Config DB.
      responses:
        '200':
          description: Prometheus metrics
          content:
            text/plain:
              schema:
                type: string

  /config/run/{id}:
    post:
      tags: [Config]
      summary: Trigger scraper run
      description: |
        Immediately triggers a scraper job to run in Config DB.

        **RBAC:** Requires Catalog read permission (`rbac.Catalog("*")`)
      parameters:
        - name: id
          in: path
          required: true
          description: The UUID of the scraper to run
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Scraper job completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobDetails'
        '400':
          description: Bad request - invalid scraper ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'
        '404':
          description: Scraper not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'

  /config/debug/routes:
    get:
      tags: [Config]
      summary: Config DB registered routes
      description: Returns all registered HTTP routes in Config DB.
      responses:
        '200':
          description: List of routes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Route'

  /config/debug/loggers:
    get:
      tags: [Config]
      summary: Config DB logger levels
      description: Returns current logging levels for Config DB.
      responses:
        '200':
          description: Logger levels
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
    post:
      tags: [Config]
      summary: Set Config DB logger level
      description: Change logging level for a Config DB logger.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [logger, level]
              properties:
                logger:
                  type: string
                level:
                  type: string
                  enum: [trace, debug, info, warn, error]
                duration:
                  type: string
                  description: Duration for temporary change (Go format)
      responses:
        '200':
          description: Logger level changed
          content:
            text/plain:
              schema:
                type: string
        '400':
          description: Missing logger name or level

  /config/debug/properties:
    get:
      tags: [Config]
      summary: Config DB supported properties
      description: Returns supported configuration properties for Config DB.
      responses:
        '200':
          description: Supported properties
          content:
            application/json:
              schema:
                type: object

  /config/debug/system/properties:
    get:
      tags: [Config]
      summary: Config DB system properties
      description: Returns current system property values for Config DB.
      responses:
        '200':
          description: System properties
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string

  /config/debug/property:
    post:
      tags: [Config]
      summary: Set Config DB property
      description: Sets a system property value in Config DB.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [name, value]
              properties:
                name:
                  type: string
                value:
                  type: string
      responses:
        '200':
          description: Property set
        '400':
          description: Missing property name or value

  /config/debug/cron:
    get:
      tags: [Config]
      summary: Config DB cron jobs
      description: Returns details about scheduled cron jobs in Config DB.
      responses:
        '200':
          description: List of cron jobs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CronEntry'

  /config/debug/cron/run:
    post:
      tags: [Config]
      summary: Trigger Config DB cron job
      description: Immediately runs a specific cron job in Config DB.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
      responses:
        '201':
          description: Cron job triggered
        '404':
          description: Cron job not found

  /config/debug/pprof:
    get:
      tags: [Config]
      summary: Config DB pprof index
      description: |
        Go pprof profiling index. **Restricted to localhost only.**
      security: []
      responses:
        '200':
          description: pprof index
          content:
            text/html:
              schema:
                type: string
        '403':
          description: Access restricted to localhost

  /config/debug/pprof/profile:
    get:
      tags: [Config]
      summary: Config DB CPU profile
      description: |
        Returns CPU profile. **Restricted to localhost only.**
      parameters:
        - name: seconds
          in: query
          schema:
            type: integer
            default: 30
      security: []
      responses:
        '200':
          description: CPU profile
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '403':
          description: Access restricted to localhost

  /kubeproxy/{path}:
    get:
      tags: [Kubernetes Proxy]
      summary: Kubernetes API proxy (GET)
      description: |
        Proxy to Kubernetes API server. Requires kubeproxy token authentication.

        Supports all Kubernetes API endpoints.
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Kubernetes API response
    post:
      tags: [Kubernetes Proxy]
      summary: Kubernetes API proxy (POST)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Kubernetes API response
    put:
      tags: [Kubernetes Proxy]
      summary: Kubernetes API proxy (PUT)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Kubernetes API response
    patch:
      tags: [Kubernetes Proxy]
      summary: Kubernetes API proxy (PATCH)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Kubernetes API response
    delete:
      tags: [Kubernetes Proxy]
      summary: Kubernetes API proxy (DELETE)
      parameters:
        - name: path
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Kubernetes API response

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: Bearer token authentication
    BasicAuth:
      type: http
      scheme: basic
      description: Basic authentication (for webhooks)

  responses:
    HTTPSuccess:
      description: Successful operation
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HTTPSuccess'
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HTTPError'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HTTPError'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HTTPError'
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HTTPError'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HTTPError'

  schemas:
    HTTPSuccess:
      type: object
      properties:
        message:
          type: string
        payload: {}

    HTTPError:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        data: {}

    Property:
      type: object
      properties:
        name:
          type: string
        value:
          type: string
        source:
          type: string
        type:
          type: string
        description:
          type: string

    Person:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        avatar:
          type: string
        properties:
          $ref: '#/components/schemas/PersonProperties'
        external_id:
          type: string

    PersonProperties:
      type: object
      properties:
        role:
          type: string

    Permission:
      type: object
      properties:
        subject:
          type: string
        object:
          type: string
        action:
          type: string
        deny:
          type: boolean

    CreateTokenRequest:
      type: object
      properties:
        name:
          type: string
        expiry:
          type: string
        auto_renew:
          type: boolean
        scope:
          type: array
          items:
            $ref: '#/components/schemas/Permission'

    AccessToken:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        expires_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    GenerateAgentRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        auto_renew:
          type: boolean
        properties:
          type: object
          additionalProperties:
            type: string

    GeneratedAgent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        access_token:
          type: string

    GenerateTokenRequest:
      type: object
      required: [agent_name]
      properties:
        agent_name:
          type: string
        auto_renew:
          type: boolean

    GeneratedToken:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        access_token:
          type: string

    PlaybookListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        title:
          type: string
        icon:
          type: string
        description:
          type: string
        category:
          type: string

    RunParams:
      type: object
      required: [id]
      properties:
        id:
          type: string
          format: uuid
        agent_id:
          type: string
          format: uuid
        config_id:
          type: string
          format: uuid
        check_id:
          type: string
          format: uuid
        component_id:
          type: string
          format: uuid
        params:
          type: object
          additionalProperties:
            type: string

    RunResponse:
      type: object
      properties:
        run_id:
          type: string
          format: uuid
        starts_at:
          type: string
          format: date-time

    GetParamsResponse:
      type: object
      properties:
        params:
          type: array
          items:
            $ref: '#/components/schemas/PlaybookParameter'

    PlaybookParameter:
      type: object
      properties:
        name:
          type: string
        default:
          type: string
        label:
          type: string
        required:
          type: boolean
        icon:
          type: string
        description:
          type: string
        type:
          type: string

    PlaybookRun:
      type: object
      properties:
        id:
          type: string
          format: uuid
        playbook_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, running, completed, failed, cancelled]
        created_at:
          type: string
          format: date-time
        scheduled_time:
          type: string
          format: date-time
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        parameters:
          type: object
          additionalProperties:
            type: string

    Event:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        created_at:
          type: string
          format: date-time
        properties:
          type: object
        error:
          type: string
        attempts:
          type: integer
        last_attempt:
          type: string
          format: date-time
        priority:
          type: integer

    ConfigSummaryRequest:
      type: object
      properties:
        changes:
          type: object
          properties:
            since:
              type: string
        analysis:
          type: object
          properties:
            since:
              type: string
        cost:
          type: string
        deleted:
          type: boolean
        filter:
          type: object
          additionalProperties:
            type: string

    ConfigSummaryResponse:
      type: object
      properties:
        summary:
          type: array
          items:
            type: object

    CatalogChangesSearchRequest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        config_type:
          type: string
        type:
          type: string
        severity:
          type: string
        include_deleted_configs:
          type: boolean
        depth:
          type: integer
        created_by:
          type: string
        summary:
          type: string
        source:
          type: string
        tags:
          type: string
        agent_id:
          type: string
        from:
          type: string
        to:
          type: string
        page_index:
          type: integer
        page_size:
          type: integer
        sort_by:
          type: string
        sort_order:
          type: string

    CatalogChangesSearchResponse:
      type: object
      properties:
        summary:
          type: object
          additionalProperties:
            type: integer
        total:
          type: integer
        changes:
          type: array
          items:
            $ref: '#/components/schemas/ConfigChange'

    ConfigChange:
      type: object
      properties:
        id:
          type: string
          format: uuid
        config_id:
          type: string
          format: uuid
        change_type:
          type: string
        severity:
          type: string
        summary:
          type: string
        source:
          type: string
        created_at:
          type: string
          format: date-time

    NotificationSendHistorySummaryRequest:
      type: object
      properties:
        groupBy:
          type: array
          items:
            type: string
        status:
          type: object
          properties:
            match:
              type: string
        resourceType:
          type: string
        tags:
          type: string
        search:
          type: string
        from:
          type: string
        to:
          type: string
        includeDeletedResources:
          type: boolean
        pageIndex:
          type: integer
        pageSize:
          type: integer

    NotificationSendHistorySummaryResponse:
      type: object
      properties:
        total:
          type: integer
        results: {}

    SilenceSaveRequest:
      type: object
      properties:
        name:
          type: string
        config_id:
          type: string
          format: uuid
        canary_id:
          type: string
          format: uuid
        check_id:
          type: string
          format: uuid
        component_id:
          type: string
          format: uuid
        from:
          type: string
        until:
          type: string
        description:
          type: string
        recursive:
          type: boolean
        filter:
          type: string
        selectors:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'

    NotificationSilencePreviewItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        notification_id:
          type: string
          format: uuid
        source_event:
          type: string
        resource_id:
          type: string
          format: uuid
        status:
          type: string
        resource:
          type: object

    ViewListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        namespace:
          type: string
        title:
          type: string
        icon:
          type: string

    ViewRequestBody:
      type: object
      properties:
        variables:
          type: object
          additionalProperties:
            type: string

    ViewResult:
      type: object
      properties:
        namespace:
          type: string
        name:
          type: string
        title:
          type: string
        icon:
          type: string
        last_refreshed_at:
          type: string
          format: date-time
        request_fingerprint:
          type: string
        columns:
          type: array
          items:
            type: object
        rows:
          type: array
          items:
            type: object
        panels:
          type: array
          items:
            type: object
        variables:
          type: array
          items:
            type: object
        column_options:
          type: object
        card:
          type: object
        sections:
          type: array
          items:
            type: object

    Artifact:
      type: object
      properties:
        id:
          type: string
          format: uuid
        playbook_run_id:
          type: string
          format: uuid
        check_id:
          type: string
          format: uuid
        check_time:
          type: string
          format: date-time
        path:
          type: string
        filename:
          type: string
        size:
          type: integer
        content_type:
          type: string
        is_json:
          type: boolean
        created_at:
          type: string
          format: date-time

    SearchResourcesRequest:
      type: object
      properties:
        limit:
          type: integer
        canaries:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'
        checks:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'
        components:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'
        configs:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'
        config_changes:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'
        playbooks:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'
        connections:
          type: array
          items:
            $ref: '#/components/schemas/ResourceSelector'

    SearchResourcesResponse:
      type: object
      properties:
        canaries:
          type: array
          items:
            $ref: '#/components/schemas/SelectedResource'
        checks:
          type: array
          items:
            $ref: '#/components/schemas/SelectedResource'
        components:
          type: array
          items:
            $ref: '#/components/schemas/SelectedResource'
        configs:
          type: array
          items:
            $ref: '#/components/schemas/SelectedResource'
        config_changes:
          type: array
          items:
            $ref: '#/components/schemas/SelectedResource'
        playbooks:
          type: array
          items:
            $ref: '#/components/schemas/SelectedResource'
        connections:
          type: array
          items:
            $ref: '#/components/schemas/SelectedResource'

    ResourceSelector:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        namespace:
          type: string
        types:
          type: array
          items:
            type: string
        statuses:
          type: array
          items:
            type: string
        labels:
          type: object
          additionalProperties:
            type: string
        field_selector:
          type: string

    SelectedResource:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        namespace:
          type: string
        type:
          type: string

    Application:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
        namespace:
          type: string
        description:
          type: string
        properties:
          type: array
          items:
            type: object
        access_control:
          type: object
        incidents:
          type: array
          items:
            type: object
        locations:
          type: array
          items:
            type: object
        backups:
          type: array
          items:
            type: object
        restores:
          type: array
          items:
            type: object
        findings:
          type: array
          items:
            type: object
        sections:
          type: array
          items:
            type: object

    LogsRequest:
      type: object
      properties:
        query:
          type: string
        start:
          type: string
        end:
          type: string
        limit:
          type: integer
        component_id:
          type: string
          format: uuid
        config_id:
          type: string
          format: uuid

    LogsResponse:
      type: object
      properties:
        logs:
          type: array
          items:
            $ref: '#/components/schemas/LogLine'
        component_logs:
          type: array
          items:
            type: object
            properties:
              component:
                type: object
              logs:
                type: array
                items:
                  $ref: '#/components/schemas/LogLine'

    LogLine:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        message:
          type: string

    TopologyResponse:
      type: object
      properties:
        components:
          type: array
          items:
            type: object
        healthStatuses:
          type: array
          items:
            type: string
        teams:
          type: array
          items:
            type: string
        tags:
          type: object
        types:
          type: array
          items:
            type: string

    JobDetails:
      type: object
      description: Details of a completed job run
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: Scraper
        success_count:
          type: integer
          example: 42
        error_count:
          type: integer
          example: 0
        hostname:
          type: string
        duration_millis:
          type: integer
          format: int64
          example: 5432
        resource_type:
          type: string
          example: scraper
        resource_id:
          type: string
        details:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [RUNNING, SUCCESS, WARNING, FAILED, STALE, SKIPPED]
        time_start:
          type: string
          format: date-time
        time_end:
          type: string
          format: date-time

    ScrapeSummary:
      type: object
      properties:
        added:
          type: integer
        updated:
          type: integer
        unchanged:
          type: integer
        deleted:
          type: integer

    CronEntry:
      type: object
      properties:
        id:
          type: string
        context:
          type: object
          additionalProperties: true
        last_ran:
          type: string
          format: date-time
        next_run:
          type: string
          format: date-time
        next_run_in:
          type: string
          example: 5m30s

    Route:
      type: object
      properties:
        method:
          type: string
          enum: [GET, POST, PUT, DELETE, PATCH, OPTIONS, HEAD]
        path:
          type: string
          example: /run/:id
        name:
          type: string
