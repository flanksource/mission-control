apiVersion: mission-control.flanksource.com/v1
kind: Playbook
metadata:
  name: ec2-restart
spec:
  'on':
    canary:
      - event: failed
        filter: check.type == 'http'
  description: Unconventional EC2 restart
  configs:
    - type: EC2 Instance
      tags:
        telemetry: enabled
  actions:
    - name: 'Stop EC2 instance'
      exec:
        script: aws ec2 stop-instance --instance-id {{.config.instanceId}}
    - name: 'Start again'
      exec:
        script: aws ec2 start-instance --instance-id {{.config.instanceId}}
